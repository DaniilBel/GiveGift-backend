# Give gifts
## Backend
Use Python (Flask).
## How to use?
1. Install all requirements (README).
2. To run use:

```python main.py```

## Rools

Система использует аккаунты пользователей с некоторыми заданными атрибутами. Далее по контексту будет ясно, какие именно
атрибуты относятся к пользователям. Ещё хранятся предпочтения (естественно, соответствующие атрибуты у пользователей должны быть
в соответствии с разрешёнными предпочтениями, считаем, что модификация Администратором предпочтений не затрагивает уже имеющиеся
у пользователей).

Некоторые запросы содержат jwt_required optional - требуется указать bearer token, иначе не вся функциональность будет доступна
(назовём такого пользователя авторизованным), jwt_required - функция доступна только авторизованным пользователям,
все конкретные ограничения указаны конкретно. По умолчанию, любая такая функция обязана проверять is_token_actual - специальный
служебный пользовательский атрибут, который устанавливается в false при выходе пользователя из системы, и выдавать соответствующее сообщение:
"token is actual". Токен также может физически устареть, необходимо поддержать его обновление (автоматическая подмена "почти"
устаревших токенов, моложе 1 часа, но старше 30 минут предусмотрена, смотрите на ответ сервера, если в нём содержится access_token,
то необходимо обновить токен у себя).

## API
### Register
POST /register
jwt_required optional
Если заходит пользователь, который не вышел из системы, регистрация
происходит без перехода на новую страницу,
в противном случае автоматически выполняется вход
```
{
"nickname":"...",
"email":"...",
"password":"...",
"birth_date":"...",
"about":"...",
"interests":[...]
}
```
Required:
nickname, email, password

Format:

nickname: (...*),

email: (\\S+@\\S+\\.\\S+), email уникальный для каждого пользователя

password: (^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*(\\W|_)).{8,}$)

birth_date: Python date string, parsed by datetime.strptime(birth_date, "%m-%d").date()

interests: список, состоящий из строк, или пустой список (по умолчанию добавятся 5 случайных предпочтений)

Error messages:

"Заполните все поля!", 401

"Слишком короткий Ник!", 401

"Введите корректный адрес электронной почты!", 401

"Введите корректный пароль! Пароль должен содержать прописные и строчные" \
               "буквы латинского алфавита, цифры. Пароль должен состоять не менее чем из" \
               "восьми символов!", 401

"Пользователь с таким email уже существует!", 401

"Логическая ошибка! Такого быть не должно! Дата - не дата!", 401

"Логическая ошибка! Такого быть не должно! Список - не список!", 401

"Логическая ошибка! Такого быть не должно! Отсутствует контроль за интересами пользователя!", 401

Successful finish:

"OK", 200 - пользователь зарегистрирован

{"access_token": access_token}, 200 - пользователь не зарегистрирован
### Login
POST /login
jwt_required optional
Если токен не является актуальным, то происходит его обновление,
в противном случае, если пользователь не вышел из системы,
ошибка "Token is actual", 401
```
{
"email":"...",
"password":"..."
}
```
Required:
all

Format:

То же, что было указано при регистрации

Error messages:

"Пользователя с данным email не существует!", 401

"Неверные имя пользователя или пароль!", 401

Successful finish:

{"access_token": access_token}, 200
### Account
jwt_required

GET /account

```
"id": "...",
"nickname": "...",
"email": "...",
"about": "...",
"birth_date": "...",
"interests": [...]
```

Выходные данные в том же формате

POST /account

```
"id": "...",
"nickname": "...",
"email": "...",
"about": "...",
"birth_date": "...",
"interests": [...]
```

Required:
all

Format:

Все упомянутые ранее поля в том же формате

"id" - число не меньше 0, уникальное для каждого пользователя

Error messages:

"Заполните поле email!", 401

"Введите корректный пароль!", 401

"Нет пользователя с данным id!", 401

"Пользователь с данным email уже существует!", 401

"Логическая ошибка! Дата не парсится!", 401

"Логическая ошибка! Список не парсится!", 401

"К сожалению, выбранный тег не поддерживается!", 401

Successful finish:

"OK", 200

GET /get_user_info/<i>

jwt_required optional

В случае, если пользователь не вошёл в систему,

/get_user_info/-1 - недоступно

```
"id": "...",
"nickname": "...",
"email": "...",
"about": "...",
"birth_date": "...",
"interests": [...]
```

/get_user_info/<id> выдаёт информацию об упомянутом пользователе

Если пользователь не вошёл в систему, то id = -1 эквивалентно GET /account

Выходные данные в том же формате
### Friends
jwt_required

GET /friends
```
"friends":[...]
"incoming_requests":[...]
"outgoing_requests":[...]
```
Все списки состоят из строк - соответствующих id

DELETE /friends
```
"friend_id":"..."
```

Required:
all

Format:

Формат, как
"id" - число не меньше 0, уникальное для каждого пользователя

Error messages:

"Вместо friend_id подали не число!", 401

"Упомянутый друг не найден в базе!", 401

"Эти люди - не друзья!", 401

Successful finish:

"OK", 200

DELETE /outgoing_friend_request

```
"friend_id":"..."
```

Required:
all

Format:

Формат, как
"id" - число не меньше 0, уникальное для каждого пользователя

Error messages:

"Вместо friend_id подали не число!", 401

"Упомянутый друг не найден в базе!", 401

"Не было исходящего запроса к этому другу!", 401

Successful finish:

"OK", 200

POST /outgoing_friend_request

```
"friend_id":"..."
```

Required:
all

Format:

Формат, как
"id" - число не меньше 0, уникальное для каждого пользователя

Error messages:

"Вместо friend_id подали не число!", 401

"Упомянутый друг не найден в базе!", 401

"Уже есть исходящий запрос к этому другу!", 401

Successful finish:

"OK", 200

DELETE /incoming_friend_request

```
"friend_id":"..."
```

Required:
all

Format:

Формат, как
"id" - число не меньше 0, уникальное для каждого пользователя

Error messages:

"Вместо friend_id подали не число!", 401

"Упомянутый друг не найден в базе!", 401

"Нет входящего запроса от упомянутого друга", 401

Successful finish:

"OK", 200

POST /incoming_friend_request

```
"friend_id":"..."
```

Required:
all

Format:

Формат, как
"id" - число не меньше 0, уникальное для каждого пользователя

Error messages:

"Вместо friend_id подали не число!", 401

"Упомянутый друг не найден в базе!", 401

"Нет входящего запроса от упомянутого друга", 401

Successful finish:

"OK", 200

### Logout
POST /logout

jwt_required

Required:
no

Format:
no

Error messages:

Successful finish:

"message": "logout successful", "code": 200

### Generate ideas
POST /generate_ideas

jwt_required optional

В случае, если пользователь не вошёл в систему, генерация идеи для
друга недоступна
```
"interests":[...],
"price_range":[...,...],
"friend_id":"...",
"num_of_ideas":"..." -- deprecated now
```
Required:
interests/friend_id,
price_range

Format:
interests: список из строк
price_range: список из ровно двух целых неотрицательных чисел, первое не превышает второе
friend_id: формат, как id

Error messages:

"Передаваемый id друга должен быть числом!", 500

"Указанный человек не является Вашим другом!", 500

"Интересы друга не указаны!", 500

"Число идей не указано!", 500

"Ценовой диапазон не указан!", 500

"Интересы должны быть представлены в виде списка!", 500

"Число предпочтений должно быть числом!", 500

"Не поддерживается число меньше 0 или больше 10!", 500

"Ценовой диапазон должен быть списком!", 500

"Ценовой диапазон может содержать лишь 2 значения!", 500

"Ценовой диапазон должен быть задан числами!", 500

Successful finish:

```
[
"title":"...",
"description":"Обработка изображений поддерживается", -- deprecated now
"img_link":"...",
"market_link":"..."
,
...
]
```

### Admin

GET /get_all_interests

```
"all_interests":[...]
```

POST /edit_interests

jwt_required

Выполняется проверка на email == 'ADMIN@ADMIN.su', может существовать
только один аккаунт с таким email, в тестовой версии создать его может любой

```
"new_interests":[...],
"edit_interests":[{"interest_name":...,"new_name":...},...]
```
Required:
all

Format:

new_interests: список из строк, новые предпочтения не должны совпадать ни с одним из старых, не может содержать ""

edit_interests: список из объектов

interest_name: строка должна быть имеющимся тэгом

new_name: строка, не должна находиться в бд, если заменяем на "",
то вместо замены происходит удаление предпочтения

Error messages:

"Только Админ может редактировать тэги!", 401

"Логическая ошибка! Такого быть не должно! Плохо парсим тэги!", 401

"Логическая ошибка! Такого быть не должно! Плохо парсим тэги!", 401

"Неверный тип тэга!", 401

"Новый тэг не так уж и нов!", 401

"Недопустимое имя тэга!", 401

"Старый тэг отсутствует в базе!", 401

"Новый тэг есть в базе!", 401

Successful finish:

"OK", 200
